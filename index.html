<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Centros de Salud - Córdoba</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Inicia el mapa
    const map = L.map('map', { zoomControl: true }).setView([-31.42, -64.18], 11);

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Ícono para Centros de Salud
    const iconoCentroSalud = L.icon({
      iconUrl: 'https://reporteyanalisisdedatos.github.io/Mapa-Sanitario-Municipalidad-de-Cordoba/CS.png',
      iconSize: [28, 28],
      iconAnchor: [14, 28],
      popupAnchor: [0, -26]
    });

    // URL del GeoJSON de efectores
    const URL_EFECTORES = 'https://reporteyanalisisdedatos.github.io/Mapa-Sanitario-Municipalidad-de-Cordoba/efectores.geojson';

    // Cargar y mostrar SOLO Centros de Salud (sin etiquetas ni filtros en UI)
    fetch(URL_EFECTORES)
      .then(res => {
        if (!res.ok) throw new Error('No se pudo cargar efectores.geojson');
        return res.json();
      })
      .then(data => {
        const features = Array.isArray(data.features) ? data.features : [];

        // Filtro básico: excluir hospitales/HPA y similares, incluir "centro de salud"
        const soloCS = features.filter(f => {
          const props = f.properties || {};
          const tipo = (props.Tipo || '').toLowerCase();
          const nombre = (props.Centro || '').toLowerCase();

          // descartar hospitales/HPA/Padre La Monaca
          if (tipo.includes('hospital') || tipo.includes('hpa') || nombre.includes('padre la monaca')) return false;

          // incluir si el tipo/nombre apunta a centro de salud
          return (
            tipo.includes('centro') ||
            tipo.includes('salud') ||
            nombre.includes('centro de salud') ||
            nombre.startsWith('cs ')
          );
        });

        // Crea la capa de puntos
        const capaCS = L.geoJSON(soloCS, {
          pointToLayer: (feature, latlng) => L.marker(latlng, { icon: iconoCentroSalud }),
          onEachFeature: (feature, layer) => {
            const p = feature.properties || {};
            // Popup minimalista (no es "etiqueta", solo al clic)
            const nombre = (p.Centro || 'Centro de Salud').split('#')[0].trim();
            const direccion = p.Direccion || 'S/D';
            layer.bindPopup(
              `<div style="font-family:sans-serif;font-size:13px;min-width:200px;">
                 <div style="font-weight:600;color:#005288;margin-bottom:6px;">${nombre}</div>
                 <div><b>Dirección:</b> ${direccion}</div>
               </div>`
            );
          }
        }).addTo(map);

        // Ajusta vista a los puntos si existen
        try {
          const bounds = capaCS.getBounds();
          if (bounds.isValid()) map.fitBounds(bounds, { padding: [20, 20] });
        } catch (e) {
          // Si no hay bounds válidos, mantiene la vista por defecto
        }
      })
      .catch(err => {
        console.error(err);
        // Fallback: vista por defecto si falla la carga
      });
  </script>
</body>
</html>


